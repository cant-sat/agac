import{ah as oe,ai as se,aj as ce,ak as ie,al as ue,am as le,an as ae,ao as fe,ap as de,aq as ve}from"./index-ba8afaa4.esm-Bcd7HwcT.js";import{g as pe,r as s,j as p}from"./index-LxnJo2Kb.js";function D(e,t,r){var n,o,i,u,l;t==null&&(t=100);function c(){var d=Date.now()-u;d<t&&d>=0?n=setTimeout(c,t-d):(n=null,r||(l=e.apply(i,o),i=o=null))}var f=function(){i=this,o=arguments,u=Date.now();var d=r&&!n;return n||(n=setTimeout(c,t)),d&&(l=e.apply(i,o),i=o=null),l};return f.clear=function(){n&&(clearTimeout(n),n=null)},f.flush=function(){n&&(l=e.apply(i,o),i=o=null,clearTimeout(n),n=null)},f}D.debounce=D;var he=D;const X=pe(he);function me(e){let{debounce:t,scroll:r,polyfill:n,offsetSize:o}=e===void 0?{debounce:0,scroll:!1,offsetSize:!1}:e;const i=n||(typeof window>"u"?class{}:window.ResizeObserver);if(!i)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[u,l]=s.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),c=s.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:u}),f=t?typeof t=="number"?t:t.scroll:null,d=t?typeof t=="number"?t:t.resize:null,w=s.useRef(!1);s.useEffect(()=>(w.current=!0,()=>void(w.current=!1)));const[_,C,h]=s.useMemo(()=>{const a=()=>{if(!c.current.element)return;const{left:R,top:j,width:O,height:M,bottom:L,right:S,x:k,y}=c.current.element.getBoundingClientRect(),v={left:R,top:j,width:O,height:M,bottom:L,right:S,x:k,y};c.current.element instanceof HTMLElement&&o&&(v.height=c.current.element.offsetHeight,v.width=c.current.element.offsetWidth),Object.freeze(v),w.current&&!ye(c.current.lastBounds,v)&&l(c.current.lastBounds=v)};return[a,d?X(a,d):a,f?X(a,f):a]},[l,o,f,d]);function E(){c.current.scrollContainers&&(c.current.scrollContainers.forEach(a=>a.removeEventListener("scroll",h,!0)),c.current.scrollContainers=null),c.current.resizeObserver&&(c.current.resizeObserver.disconnect(),c.current.resizeObserver=null)}function x(){c.current.element&&(c.current.resizeObserver=new i(h),c.current.resizeObserver.observe(c.current.element),r&&c.current.scrollContainers&&c.current.scrollContainers.forEach(a=>a.addEventListener("scroll",h,{capture:!0,passive:!0})))}const P=a=>{!a||a===c.current.element||(E(),c.current.element=a,c.current.scrollContainers=G(a),x())};return we(h,!!r),be(C),s.useEffect(()=>{E(),x()},[r,h,C]),s.useEffect(()=>E,[]),[P,u,_]}function be(e){s.useEffect(()=>{const t=e;return window.addEventListener("resize",t),()=>void window.removeEventListener("resize",t)},[e])}function we(e,t){s.useEffect(()=>{if(t){const r=e;return window.addEventListener("scroll",r,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",r,!0)}},[e,t])}function G(e){const t=[];if(!e||e===document.body)return t;const{overflow:r,overflowX:n,overflowY:o}=window.getComputedStyle(e);return[r,n,o].some(i=>i==="auto"||i==="scroll")&&t.push(e),[...t,...G(e.parentElement)]}const Ee=["x","y","top","bottom","left","right","width","height"],ye=(e,t)=>Ee.every(r=>e[r]===t[r]);var ge=Object.defineProperty,Ce=Object.defineProperties,xe=Object.getOwnPropertyDescriptors,Y=Object.getOwnPropertySymbols,Oe=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable,q=(e,t,r)=>t in e?ge(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,A=(e,t)=>{for(var r in t||(t={}))Oe.call(t,r)&&q(e,r,t[r]);if(Y)for(var r of Y(t))ze.call(t,r)&&q(e,r,t[r]);return e},_e=(e,t)=>Ce(e,xe(t)),V,U;typeof window<"u"&&((V=window.document)!=null&&V.createElement||((U=window.navigator)==null?void 0:U.product)==="ReactNative")?s.useLayoutEffect:s.useEffect;function J(e,t,r){if(!e)return;if(r(e)===!0)return e;let n=e.child;for(;n;){const o=J(n,t,r);if(o)return o;n=n.sibling}}function K(e){try{return Object.defineProperties(e,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return e}}const $=console.error;console.error=function(){const e=[...arguments].join("");if(e!=null&&e.startsWith("Warning:")&&e.includes("useContext")){console.error=$;return}return $.apply(this,arguments)};const F=K(s.createContext(null));class Q extends s.Component{render(){return s.createElement(F.Provider,{value:this._reactInternals},this.props.children)}}function Pe(){const e=s.useContext(F);if(e===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const t=s.useId();return s.useMemo(()=>{for(const n of[e,e==null?void 0:e.alternate]){if(!n)continue;const o=J(n,!1,i=>{let u=i.memoizedState;for(;u;){if(u.memoizedState===t)return!0;u=u.next}});if(o)return o}},[e,t])}function Re(){const e=Pe(),[t]=s.useState(()=>new Map);t.clear();let r=e;for(;r;){if(r.type&&typeof r.type=="object"){const o=r.type._context===void 0&&r.type.Provider===r.type?r.type:r.type._context;o&&o!==F&&!t.has(o)&&t.set(o,s.useContext(K(o)))}r=r.return}return t}function je(){const e=Re();return s.useMemo(()=>Array.from(e.keys()).reduce((t,r)=>n=>s.createElement(t,null,s.createElement(r.Provider,_e(A({},n),{value:e.get(r)}))),t=>s.createElement(Q,A({},t))),[e])}const B={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Me(e){const{handlePointer:t}=ve(e);return{priority:1,enabled:!0,compute(r,n,o){n.pointer.set(r.offsetX/n.size.width*2-1,-(r.offsetY/n.size.height)*2+1),n.raycaster.setFromCamera(n.pointer,n.camera)},connected:void 0,handlers:Object.keys(B).reduce((r,n)=>({...r,[n]:t(n)}),{}),update:()=>{var r;const{events:n,internal:o}=e.getState();(r=o.lastEvent)!=null&&r.current&&n.handlers&&n.handlers.onPointerMove(o.lastEvent.current)},connect:r=>{var n;const{set:o,events:i}=e.getState();i.disconnect==null||i.disconnect(),o(u=>({events:{...u.events,connected:r}})),Object.entries((n=i.handlers)!=null?n:[]).forEach(([u,l])=>{const[c,f]=B[u];r.addEventListener(c,l,{passive:f})})},disconnect:()=>{const{set:r,events:n}=e.getState();if(n.connected){var o;Object.entries((o=n.handlers)!=null?o:[]).forEach(([i,u])=>{if(n&&n.connected instanceof HTMLElement){const[l]=B[i];n.connected.removeEventListener(l,u)}}),r(i=>({events:{...i.events,connected:void 0}}))}}}}const Le=s.forwardRef(function({children:t,fallback:r,resize:n,style:o,gl:i,events:u=Me,eventSource:l,eventPrefix:c,shadows:f,linear:d,flat:w,legacy:_,orthographic:C,frameloop:h,dpr:E,performance:x,raycaster:P,camera:a,scene:R,onPointerMissed:j,onCreated:O,...M},L){s.useMemo(()=>oe(de),[]);const S=je(),[k,y]=me({scroll:!0,debounce:{scroll:50,resize:0},...n}),v=s.useRef(null),T=s.useRef(null);s.useImperativeHandle(L,()=>v.current);const I=se(j),[N,Z]=s.useState(!1),[W,ee]=s.useState(!1);if(N)throw N;if(W)throw W;const z=s.useRef(null);ce(()=>{const g=v.current;y.width>0&&y.height>0&&g&&(z.current||(z.current=ie(g)),z.current.configure({gl:i,events:u,shadows:f,linear:d,flat:w,legacy:_,orthographic:C,frameloop:h,dpr:E,performance:x,raycaster:P,camera:a,scene:R,size:y,onPointerMissed:(...m)=>I.current==null?void 0:I.current(...m),onCreated:m=>{m.events.connect==null||m.events.connect(l?ue(l)?l.current:l:T.current),c&&m.setEvents({compute:(H,b)=>{const re=H[c+"X"],ne=H[c+"Y"];b.pointer.set(re/b.size.width*2-1,-(ne/b.size.height)*2+1),b.raycaster.setFromCamera(b.pointer,b.camera)}}),O==null||O(m)}}),z.current.render(p.jsx(S,{children:p.jsx(le,{set:ee,children:p.jsx(s.Suspense,{fallback:p.jsx(ae,{set:Z}),children:t})})})))}),s.useEffect(()=>{const g=v.current;if(g)return()=>fe(g)},[]);const te=l?"none":"auto";return p.jsx("div",{ref:T,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:te,...o},...M,children:p.jsx("div",{ref:k,style:{width:"100%",height:"100%"},children:p.jsx("canvas",{ref:v,style:{display:"block"},children:r})})})}),De=s.forwardRef(function(t,r){return p.jsx(Q,{children:p.jsx(Le,{...t,ref:r})})});export{De as C};
